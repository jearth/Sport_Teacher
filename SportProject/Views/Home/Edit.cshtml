@using SportProject.DTO
@model LeaderInfoDetailDTO;
@{
    ViewBag.title = "지도자 수정";
    Layout = "../Shared/_Layout.cshtml";
}

<link href="~/css/Register.css" rel="stylesheet" type="text/css">
<h4 class="title-heading">지도자 등록하기</h4>
<div class="container" id="container1">
    <div class="d-flex flex-column align-items-center">
        <form action="" method="post" id="main_form">
            <h4 class="section-heading1">1. 일반 현황(2023년 01월 01일 기준)<span class="required-field">* 필수입력값 항목입니다.</span><hr class="section-hr"></h4>
            <div class="container custom-container">
                <div class="row">
                    <div class="col-sm-3 left-content">
                        <div id="image-container">
                            <label for="file-input" id="image-placeholder">
                                <div id="upload-button">사진 첨부하기</div>
                            </label>
                            <!--프론트 단에서만 필요-->
                            <input type="file" id="file-input" accept="image/*" value="@Model.ImageBase">
                            <!--컨트롤러로 보낼 데이터-->
                            <input type="hidden" id="hidden-input" name="ImageBase" value="">
                            <img id="selected-image" alt="">
                            <p>파일 크기는 MB 이하로 등록해주세요.</p>
                        </div>
                    </div>
                    <div class="col-sm-9 right-content">
                        <div class="row custom-row">
                            <div class="col-6 col-sm-6">
                                <h8 id="code-heading" class="custom-heading">
                                    식별코드 <span class="highlight-text">*</span>
                                    <div class="input-group mb-3">
                                        <input type="text" class="form-control" value="@Model.LeaderNo" aria-describedby="button-Leader" name="LeaderNo" required>
                                        <button class="btn btn-outline-secondary" type="button" id="button-Leader">식별코드검색</button>
                                    </div>
                                </h8>
                            </div>
                            <div class="col-6 col-sm-6">
                                <h8 id="school-heading" class="custom-heading">
                                    학교명<span class="highlight-text">*</span>
                                    <div class="input-group mb-3">
                                        <input type="text" class="form-control" id="schoolcode-heading" value="@Model.SchoolName" aria-label="학교명을 선택해주세요." aria-describedby="button-addon-School" required>
                                        <input type="hidden" id="hidden-SchoolName" name="SchoolNo" />
                                        <button class="btn btn-outline-secondary" type="button" id="button-addon-School">학교명검색</button>
                                    </div>
                                </h8>
                            </div>
                            <div id="SchoolModal" class="modal">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h2>학교 식별코드 검색</h2>
                                        <span class="close" onclick="closeModal('SchoolModal')">&times;</span>
                                    </div>
                                    <!-- 모달 내용 -->
                                    <div class="search-container2">
                                        <p>학교명</p>
                                        <input type="text" id="schoolCodeInput" placeholder="학교명을 입력해주세요.">
                                        <button id="searchSchoolButton">검색하기</button>
                                    </div>
                                    <div id="schoolTable">
                                        <h2>
                                            총 학교
                                            <p id="totalSchool">총</p>
                                        </h2>
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>번호</th>
                                                    <th>학교명</th>
                                                </tr>
                                            </thead>
                                            <tbody class="schoolTable_body"></tbody>
                                        </table>
                                    </div>
                                    <div class="button-box3">
                                        <div class="button delete3" id="cancelSchool">취소하기</div>
                                        <div class="button register3" id="registerSchool">등록하기</div>
                                        <div id="registerPopup2" class="popup">
                                            <h2>선택된 학교 없음</h2>
                                            <span class="Schoolclose" onclick="closePopup('registerPopup2')">&times;</span>
                                            <p>선택된 학교명이 없습니다. </br>학교명을 선택해주시기 바랍니다.</p>
                                            <button class="confirm">확인</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row custom-row">
                            <div class="col-4 col-sm-4">
                                <h8 id="name-heading" class="custom-heading">
                                    성명<span class="highlight-text">*</span>
                                    <div class="input-group mb-3">
                                        <input type="text" class="form-control" value="@Model.LeaderName" id="leaderNameResult" name="LeaderName" required>
                                    </div>
                                </h8>
                            </div>
                            <div class="col-4 col-sm-4">
                                <h8 id="dob-heading" class="custom-heading">
                                    생년월일<span class="highlight-text">*</span>
                                    <div class="mb-3">
                                        <input type="date" class="form-control" id="birthdate" value="@Model.Birthday" name="Birthday" required>
                                    </div>
                                </h8>
                            </div>
                            <div class="col-4 col-sm-4">
                                <h8 id="gender-heading" class="custom-heading">
                                    성별<span class="highlight-text">*</span>
                                    <div class="gender-checkboxes">
                                        <label>
                                            <input type="radio" name="Gender" value="M" checked>
                                            남자
                                        </label>
                                        <label>
                                            <input type="radio" name="Gender" value="W">
                                            여자
                                        </label>
                                    </div>
                                </h8>
                            </div>
                        </div>
                        <div class="row custom-row">
                            <div class="col-4 col-sm-4">
                                <h8 id="sport-heading" class="custom-heading">
                                    종목<span class="highlight-text">*</span>
                                    <div class="sport-select">
                                        <select class="form-select" aria-label="종목을 선택해주세요." id="sport-select-container1" name="SportNo">
                                            <option value="">종목을 선택해주세요.</option>
                                        </select>
                                    </div>
                                </h8>
                            </div>
                            <div class="col-4 col-sm-4">
                                <h8 id="phone-heading" class="custom-heading">근무지 전화번호</h8><span class="highlight-text">*</span>
                                <div class="d-inline-flex" id="tel-heading">
                                    <input type="tel" size="3" name="tel1" class="form-control custom-input" placeholder="063" maxlength="3">
                                    <span class="dash">-</span>
                                    <input type="tel" size="4" name="tel2" class="form-control custom-input" placeholder="1234" maxlength="4">
                                    <span class="dash">-</span>
                                    <input type="tel" size="4" name="tel3" class="form-control custom-input" placeholder="5678" maxlength="4">
                                    <input type="hidden" name="TelNo" id="hidden-tel">
                                </div>
                            </div>
                            <div class="col-4 col-sm-4">
                                <h8 id="hire-date-heading" class="custom-heading">
                                    최초채용<span class="highlight-text">*</span>
                                    <div class="mb-3">
                                        <input type="date" class="form-control" id="hire" data-placeholder="최초채용일을 선택해주세요." name="EmpDT" required>
                                        <p>최초 채용일은 <span class="highlight-text">전라북도 교육청 소속 최초 채용일을</span> 선택해주세요.</p>
                                    </div>
                                </h8>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <h4 class="section-heading2">
                2. 근무 이력(전라북도교육청 소속 - 최초 채용일로부터)<span class="required-field">필수입력값 항목입니다.</span><hr class="section-hr">
                <p>※ 현재 근무 중인 경우 근무 종료일을 입력하지 마십시오.</p>
                <table id="Employment-History-Table">
                    <tr>
                        <th>근무기관</th>
                        <th>근무시작일</th>
                        <th>근무종료일</th>
                        <th>종목</th>
                    </tr>
                    <tr class="Employment-History-Tr">
                        <td><input type="text" class="school-name" placeholder="학교명을 입력해주세요." name="Work[0].WorkPlace"></td>
                        <td><input type="date" class="form-control" id="start-date" name="Work[0].StartDT" data-placeholder="근무 시작일을 선택해주세요." required></td>
                        <td><input type="date" class="form-control" id="end-date" name="Work[0].EndDT" data-placeholder="근무 종료일을 선택해주세요." required></td>
                        <td id="sport-table">
                            <select class="form-select" aria-label="종목을 선택해주세요." id="sport-select-container2" name="Work[0].SportNo">
                                <option value="">종목을 선택해주세요.</option>
                            </select>
                            <button onclick="addHistoryRow(this)">추가</button>
                        </td>
                    </tr>
                </table>
            </h4>
            <h4 class="section-heading3">
                3. 자격사항<span class="required-field">필수입력값 항목입니다.</span><hr class="section-hr">
                <table id="Certificate-Table">
                    <tr>
                        <th>자격/면허</th>
                        <th>자격번호</th>
                        <th>취득일자</th>
                        <th>발급기관</th>
                    </tr>
                    <tr class="Certificate-Table-Tr">
                        <td><input type="text" class="qualification" name="Certificate[0].CertificateName" placeholder="자격을 입력해주세요."></td>
                        <td><input type="text" class="qualification-number" name="Certificate[0].CertificateNumber" placeholder="영문, 숫자만 입력해주세요."></td>
                        <td>
                            <input type="date" class="form-control" id="get-date" name="Certificate[0].CertificateDT" data-placeholder="취득일자를 선택해주세요." required>
                        </td>
                        <td>
                            <input type="text" class="origanization-name" placeholder="발급기관을 입력해주세요." name="Certificate[0].Origanization">
                            <button onclick="addCertificateRow(this)">추가</button>
                        </td>
                    </tr>
                </table>
            </h4>
            <div class="button-box">
                <div class="button delete">취소하기</div>
                <div id="cancelPopup" class="popup">
                    <h2>지도자 등록 취소</h2>
                    <span class="close" onclick="closePopup('cancelPopup')">&times;</span>
                    <p>지도자 등록을 취소하시겠습니까? </br> 작성한 내용은 모두 삭제됩니다.</p>
                    <button class="cancel">취소</button>
                    <button class="confirm">확인</button>
                </div>
                <div id="register" class="button register" name="submit">등록하기</div>
                <div id="button-register-error" class="popup">
                    <h2>필수입력값 확인</h2>
                    <span class="close" onclick="closePopup('button-register-error')">&times;</span>
                    <p>필수입력값이 채워지지 않았습니다. </br>확인후 채워주시기 바랍니다.</p>
                    <button class="confirm">확인</button>
                </div>
                <div id="button-register-success" class="popup">
                    <h2>지도자 등록</h2>
                    <span class="close" onclick="closePopup('button-register-success')">&times;</span>
                    <p>입력한 내용으로 지도자를 등록하시겠습니까?</p>
                    <button class="cancel">취소</button>
                    <button id="submitBtn" class="confirm" type="button" onclick="submitData()">확인</button>
                </div>
            </div>
        </form>
    </div>
</div>
@section scripts {
    <script>
         $(document).ready(function () {
            // URL에서 식별코드 파라미터 읽기
            var urlParams = new URLSearchParams(window.location.search);
            var leaderNo = urlParams.get('leaderNo');

            // loadLeaderDetails(leaderNo);
        });

        

        // 날짜 형식을 가공하는 함수
        function formatDate(dateString) {
            var date = new Date(dateString);
            var formattedDate = date.getFullYear() + '.' + (date.getMonth() + 1) + '.' + date.getDate();
            return formattedDate;
        }

        // 근무이력 테이블
        function fillHistoryTable(historyData) {
            var historyStr = '';
            $.each(historyData, function (i, val) {
                var formattedStartDT = formatDate(val.startDT); // 날짜 형식 가공
                var formattedEndDT = formatDate(val.endDT); // 종료일 가공

                historyStr += '<tr><td>' + val.workPlace + '</td><td>' + formattedStartDT + '</td><td>' + formattedEndDT + '</td><td>' + val.sportName + '</td></tr>';
            });
            $('.historyTable_body').append(historyStr);
        }

        // 자격사항 테이블
        function fillCertificateTable(certificateData) {
            var certificateStr = '';
            $.each(certificateData, function (i, val) {
                var formattedCertificateDT = formatDate(val.certificateDT); // 날짜 형식 가공

                certificateStr += '<tr><td>' + val.certificateName + '</td><td>' + val.certificateNumber + '</td><td>' + formattedCertificateDT + '</td><td>' + val.origanization + '</td></tr>';
            });
            $('.certificateTable_body').append(certificateStr);
        }

        // 받아온 데이터를 화면에 표시하는 함수
        function displayData(data) {
            // console.log(`data: ${typeof data}`);
            console.log(`data: ${JSON.stringify(data)}`);

            // 이미지 태그
            $('#leader-image').attr('src', data.imageBase); // 제이쿼리 attr -> 속성값을 가져오거나 변경할 수 있는 함수

            var birthday = new Date(data.birthday);
            var empDT = new Date(data.empDT);

            // 원하는 형식으로 가공하기
            var formattedbirthday = birthday.getFullYear() + '.' + (birthday.getMonth() + 1) + '.' + birthday.getDate();
            var formattedempDT = empDT.getFullYear() + '.' + (empDT.getMonth() + 1) + '.' + empDT.getDate();

            // 다른 데이터 표시
            $('#leaderNoResult').text(data.leaderNo);
            $('#schoolNameResult').text(data.schoolName);
            $('#leaderNameResult').text(data.leaderName);
            $('#birthdayResult').text(formattedbirthday);
            $('#genderResult').text(data.gender);
            $('#sportNameResult').text(data.sportName);
            $('#telNoResult').text(data.telNo);
            $('#empDTResult').text(formattedempDT);
        }
    </script>
}
